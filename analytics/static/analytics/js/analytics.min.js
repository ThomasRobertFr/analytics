!function(){function a(a){"use strict";var b={version:"0.1.0",csts:{crossfilterClientVsServerThreshold:2e4,resizeDelay:350,css:{header:".navbar",columnsContainer:"#columns",columns:".chart-columns",columnsSortable:".chart-columns-sortable",charts:".chart",chartsClass:"chart",factSelector:"#fact-selector",reset:"#reset",resize:"#resize",addchart:"#addchart",zoom:"zoom"},palettes:["YlGn","GnBu","BuPu","RdPu","PuRd","OrRd","YlOrRd","YlOrBr","PuOr","BrBG","PRGn","PiYG","RdBu","RdGy","RdYlBu","RdYlGn"],txts:{charts:{map:"Choropleth map",bar:"Bar chart",pie:"Pie chart",timeline:"Timeline",bubble:"Bubble chart",table:"Table",wordcloud:"Word cloud chart"},factSelector:{cubes:"Cubes available:",measures:"Measures available:"},hiddenChart:"This chart is hidden because the dimension shown is aggregated",changeCube:"You are changing the cube beeing studied. If you continue, your current analysis of this cube will be lost. Do you want to continue?"},tips:{charts:{}}}};return b.init=function(a,c){b.query.queryAPI(a),c&&b.state(c),b.query.queryAPI(a),b.display.init(),b.state.initMeasure(),b.state.initDimensions(),b.data.load(),b.display.render()},b.setCsts=function(a){function c(a,b){for(var d in b){var e=Array.isArray(a[d])?"array":typeof a[d],f=Array.isArray(b[d])?"array":typeof b[d];"object"==e&&"object"==f?c(a[d],b[d]):"undefined"!=typeof e&&"object"!=typeof e&&"undefined"!=f&&"object"!=f&&(a[d]=b[d])}}c(b.csts,a)},b.query=function(){var a=null,b={queryAPI:function(b){if(arguments.length)return a=b,this;if(null===a)throw new this.QueryAPINotProvidedError;return a},metadatas:{},mapWithCaptionToSimpleMap:function(a){var b={};for(var c in a)b[c]=a[c].caption;return b},getSchemas:function(){if(this.isCacheEmpty()){var a=this.queryAPI().explore([]);this.checkAPIResponse(a);var b=this.mapWithCaptionToSimpleMap(a.data);for(var c in b)this.cacheSchema(c,b[c]);return b}return this.getSchemasFromCache()},getCubes:function(a){if(this.isSchemaInCache(a)||this.getSchemas(),this.isCubesListEmpty(a)){var b=this.queryAPI().explore(new Array(a));this.checkAPIResponse(b);var c=this.mapWithCaptionToSimpleMap(b.data);for(var d in c)this.cacheCube(a,d,c[d]);return c}return this.getCubesFromCache(a)},getMesures:function(a,c){this.isDimensionsListEmpty(a,c)&&this.getDimensions(a,c);var d,e=this.getMeasureDimension(a,c),f=this.getHierarchies(a,c,e);for(var g in f)d=g;if(this.getLevels(a,c,e,d),this.isLevelsListEmpty(a,c,e,d))throw new b.LevelNotInDatabaseError("No level in Measure's hierarchy");return this.getMembers(a,c,e,d,0)},getCubesAndMeasures:function(a){var b={},c=this.getCubes(a);for(var d in c){b[d]={caption:c[d],measures:{}};var e=this.getMesures(a,d);for(var f in e)b[d].measures[f]=e[f]}return b},getDimensions:function(a,b){this.isCubeInCache(a,b)||this.getCubes(a);var c,d={};if(this.isDimensionsListEmpty(a,b)){var e=this.queryAPI().explore(new Array(a,b));this.checkAPIResponse(e);for(var f in e.data)this.cacheDimension(a,b,f,e.data[f].type,e.data[f].caption,e.data[f].description);c=e.data}else c=this.getDimensionsFromCache(a,b);for(var g in c)"Measure"!=c[g].type&&(d[g]=c[g]);return d},getGeoDimension:function(a,b){return this.getXXDimension(a,b,"Geometry")},getTimeDimension:function(a,b){return this.getXXDimension(a,b,"Time")},getMeasureDimension:function(a,b){return this.getXXDimension(a,b,"Measure")},getXXDimension:function(a,c,d){if(!this.isAllowedDimensionType(d))throw new b.IllegalDimensionTypeError;this.getDimensions(a,c);var e=this.getDimensionsFromCache(a,c);for(var f in e)if(e[f].type==d)return f;throw new b.DimensionNotInDatabaseError("There's no dimension of type "+d+" in cube "+c+" of schema "+a)},getGeoProperty:function(a,b,c,d){for(var e=this.getLevels(a,b,c,d),f=0;f<e.length;f++){var g=this.getProperties(a,b,c,d,f);for(var h in g)if("Geometry"==g[h].type)return h}return null},getHierarchies:function(a,b,c){if(this.isDimensionInCache(a,b,c)||this.getDimensions(a,b),this.isHierarchiesListEmpty(a,b,c)){var d=this.queryAPI().explore(new Array(a,b,c));this.checkAPIResponse(d);var e=this.mapWithCaptionToSimpleMap(d.data);for(var f in e)this.cacheHierarchy(a,b,c,f,e[f]);return e}return this.getHierarchiesFromCache(a,b,c)},getLevels:function(a,b,c,d){if(this.isHierarchyInCache(a,b,c,d)||this.getHierarchies(a,b,c),this.isLevelsListEmpty(a,b,c,d)){var e=this.queryAPI().explore(new Array(a,b,c,d),!0);this.checkAPIResponse(e);for(var f=[],g=0;g<e.data.length;g++){this.cacheLevel(a,b,c,d,e.data[g].id,e.data[g].caption,e.data[g].description),f.push(e.data[g].caption);for(var h in e.data[g]["list-properties"])this.cacheProperty(a,b,c,d,g,h,e.data[g]["list-properties"][h].caption,e.data[g]["list-properties"][h].description,e.data[g]["list-properties"][h].type)}return f}return this.getLevelsFromCache(a,b,c,d)},getMembers:function(a,c,d,e,f,g,h,i){if(!this.isLevelInCache(a,c,d,e,f)&&(this.getLevels(a,c,d,e),!this.isLevelInCache(a,c,d,e,f)))throw new b.LevelNotInDatabaseError;g="undefined"!=typeof g?g:!1,"undefined"!=typeof h&&(i="undefined"!=typeof i?i:1);var j,k=this.getLevelIDFromIndex(a,c,d,e,f);if(j="undefined"==typeof h?this.queryAPI().explore(new Array(a,c,d,e,k),g):this.queryAPI().explore(new Array(a,c,d,e,k,h),g,i),this.checkAPIResponse(j),g===!0&&j.data!={}){var l=this.getGeoProperty(a,c,d,e);if(void 0!==l&&null!==l){var m=new Wkt.Wkt;for(var n in j.data)void 0!==j.data[n][l]&&(m.read(j.data[n][l]),j.data[n][l]=m.toJson())}}return j.data},getMembersInfos:function(a,c,d,e,f,g,h){if("object"!=typeof g)throw new Error("You provided an illegal parameter. Array expected");if(!this.isLevelInCache(a,c,d,e,f)&&(this.getLevels(a,c,d,e),!this.isLevelInCache(a,c,d,e,f)))throw new b.LevelNotInDatabaseError;h="undefined"!=typeof h?h:!1;var i=this.getLevelIDFromIndex(a,c,d,e,f),j=this.queryAPI().explore(new Array(a,c,d,e,i,g),h,0);if(this.checkAPIResponse(j),h===!0&&j.data!={}){var k=this.getGeoProperty(a,c,d,e);if(void 0!==k&&null!==k){var l=new Wkt.Wkt;for(var m in j.data)void 0!==j.data[m][k]&&(l.read(j.data[m][k]),j.data[m][k]=l.toJson())}}return j.data},getProperties:function(a,b,c,d,e){return this.isLevelInCache(a,b,c,d,e)||this.getLevels(a,b,c,d),this.getPropertiesFromCache(a,b,c,d,e)},drill:function(a){this.queryAPI().drill(a)},push:function(a){this.queryAPI().push(a)},pull:function(a){this.queryAPI().pull(a)},slice:function(a,b,c){this.queryAPI().slice(a,b,c)},dice:function(a){this.queryAPI().dice(a)},project:function(a){this.queryAPI().project(a)},filter:function(a,b,c){this.queryAPI().filter(a,b,c)},execute:function(){var a=this.queryAPI().execute();return this.checkAPIResponse(a),a.data},clear:function(){this.queryAPI().clear()},checkAPIResponse:function(a){if("BAD_REQUEST"===a.error)throw new b.QueryAPIBadRequestError;if("NOT_SUPPORTED"===a.error)throw new b.QueryAPINotSupportedError;if("SERVER_ERROR"===a.error)throw new b.QueryAPIServerError;if(void 0===a.error||void 0===a.data||a==={})throw new b.IllegalAPIResponseError;return!0},isAllowedDimensionType:function(a){return"Time"===a||"Measure"==a||"Standard"==a||"Geometry"==a},cacheSchema:function(a,b){this.isSchemaInCache(a)||(this.isCacheEmpty()&&(this.metadatas.schemas={}),this.metadatas.schemas[a]={caption:b})},cacheCube:function(a,b,c,d){this.isCubeInCache(a,b)||(void 0===this.metadatas.schemas[a].cubes&&(this.metadatas.schemas[a].cubes={}),this.metadatas.schemas[a].cubes[b]={caption:c,description:d})},cacheDimension:function(a,c,d,e,f,g){if(!this.isAllowedDimensionType(e))throw new b.IllegalDimensionTypeError(e+" is not a valid dimension type!");this.isDimensionInCache(a,c,d)||(void 0===this.metadatas.schemas[a].cubes[c].dimensions&&(this.metadatas.schemas[a].cubes[c].dimensions={}),this.metadatas.schemas[a].cubes[c].dimensions[d]={type:e,caption:f,description:g})},cacheHierarchy:function(a,b,c,d,e,f){this.isHierarchyInCache(a,b,c,d)||(void 0===this.metadatas.schemas[a].cubes[b].dimensions[c].hierarchies&&(this.metadatas.schemas[a].cubes[b].dimensions[c].hierarchies={}),this.metadatas.schemas[a].cubes[b].dimensions[c].hierarchies[d]={caption:e,description:f})},cacheLevel:function(a,b,c,d,e,f,g){this.isLevelInCache(a,b,c,d,e)||(void 0===this.metadatas.schemas[a].cubes[b].dimensions[c].hierarchies[d].levels&&(this.metadatas.schemas[a].cubes[b].dimensions[c].hierarchies[d].levels=[]),this.metadatas.schemas[a].cubes[b].dimensions[c].hierarchies[d].levels.push({id:e,caption:f,description:g}))},cacheProperty:function(a,b,c,d,e,f,g,h,i){this.isPropertyInCache(a,b,c,d,e,f)||(void 0===this.metadatas.schemas[a].cubes[b].dimensions[c].hierarchies[d].levels[e].properties&&(this.metadatas.schemas[a].cubes[b].dimensions[c].hierarchies[d].levels[e].properties={}),this.metadatas.schemas[a].cubes[b].dimensions[c].hierarchies[d].levels[e].properties[f]={caption:g,description:h,type:i})},isSchemaInCache:function(a){if(this.isCacheEmpty())return!1;for(var b in this.metadatas.schemas)if(b==a)return!0;return!1},isCubeInCache:function(a,b){if(this.isCubesListEmpty(a))return!1;for(var c in this.metadatas.schemas[a].cubes)if(c==b)return!0;return!1},isDimensionInCache:function(a,b,c){if(this.isDimensionsListEmpty(a,b))return!1;for(var d in this.metadatas.schemas[a].cubes[b].dimensions)if(d==c)return!0;return!1},isHierarchyInCache:function(a,b,c,d){if(this.isHierarchiesListEmpty(a,b,c))return!1;for(var e in this.metadatas.schemas[a].cubes[b].dimensions[c].hierarchies)if(e==d)return!0;return!1},isLevelInCache:function(a,b,c,d,e){return!this.isLevelsListEmpty(a,b,c,d)&&void 0!==this.metadatas.schemas[a].cubes[b].dimensions[c].hierarchies[d].levels[e]},isPropertyInCache:function(a,b,c,d,e,f){if(this.isPropertiesListEmpty(a,b,c,d,e))return!1;for(var g in this.metadatas.schemas[a].cubes[b].dimensions[c].hierarchies[d].levels[e].properties)if(g==f)return!0;return!1},isCacheEmpty:function(){return 0===Object.keys(this.metadatas).length&&void 0===this.metadatas.schemas},isCubesListEmpty:function(a){if(!this.isSchemaInCache(a)&&(this.getSchemas(),!this.isSchemaInCache(a)))throw new b.SchemaNotInDatabaseError("Query: The given schema is not in metadatas cache");return void 0===this.metadatas.schemas[a].cubes||0===Object.keys(this.metadatas.schemas[a].cubes).length},isDimensionsListEmpty:function(a,c){if(!this.isCubeInCache(a,c)&&(this.getCubes(a),!this.isCubeInCache(a,c)))throw new b.CubeNotInDatabaseError;return void 0===this.metadatas.schemas[a].cubes[c].dimensions||0===Object.keys(this.metadatas.schemas[a].cubes[c].dimensions).length},isHierarchiesListEmpty:function(a,c,d){if(!this.isDimensionInCache(a,c,d)&&(this.getDimensions(a,c),!this.isDimensionInCache(a,c,d)))throw new b.DimensionNotInDatabaseError;return void 0===this.metadatas.schemas[a].cubes[c].dimensions[d].hierarchies||0===Object.keys(this.metadatas.schemas[a].cubes[c].dimensions[d].hierarchies).length},isLevelsListEmpty:function(a,c,d,e){if(!this.isHierarchyInCache(a,c,d,e)&&(this.getHierarchies(a,c,d),!this.isHierarchyInCache(a,c,d,e)))throw new b.HierarchyNotInDatabaseError;return void 0===this.metadatas.schemas[a].cubes[c].dimensions[d].hierarchies[e].levels||0===this.metadatas.schemas[a].cubes[c].dimensions[d].hierarchies[e].levels.length},isPropertiesListEmpty:function(a,c,d,e,f){if(!this.isLevelInCache(a,c,d,e,f)&&(this.getLevels(a,c,d,e),!this.isLevelInCache(a,c,d,e,f)))throw new b.LevelNotInDatabaseError;return void 0===this.metadatas.schemas[a].cubes[c].dimensions[d].hierarchies[e].levels[f].properties||0===Object.keys(this.metadatas.schemas[a].cubes[c].dimensions[d].hierarchies[e].levels[f].properties).length},clearCache:function(){this.isCacheEmpty()||delete this.metadatas.schemas},getSchemasFromCache:function(){return this.isCacheEmpty()?{}:this.mapWithCaptionToSimpleMap(this.metadatas.schemas)},getCubesFromCache:function(a){return this.isCubesListEmpty(a)?{}:this.mapWithCaptionToSimpleMap(this.metadatas.schemas[a].cubes)},getDimensionsFromCache:function(a,b){return this.isDimensionsListEmpty(a,b)?{}:this.metadatas.schemas[a].cubes[b].dimensions},getHierarchiesFromCache:function(a,b,c){return this.isHierarchiesListEmpty(a,b,c)?{}:this.mapWithCaptionToSimpleMap(this.metadatas.schemas[a].cubes[b].dimensions[c].hierarchies)},getLevelsFromCache:function(a,b,c,d){if(this.isLevelsListEmpty(a,b,c,d))return[];for(var e=[],f=0;f<this.metadatas.schemas[a].cubes[b].dimensions[c].hierarchies[d].levels.length;f++)e[f]=this.metadatas.schemas[a].cubes[b].dimensions[c].hierarchies[d].levels[f].caption;return e},getPropertiesFromCache:function(a,b,c,d,e){return this.isPropertiesListEmpty(a,b,c,d,e)?{}:this.metadatas.schemas[a].cubes[b].dimensions[c].hierarchies[d].levels[e].properties},getLevelIDFromIndex:function(a,c,d,e,f){if(!this.isLevelInCache(a,c,d,e,f))throw new b.LevelNotInDatabaseError;return this.metadatas.schemas[a].cubes[c].dimensions[d].hierarchies[e].levels[f].id},SchemaNotInDatabaseError:function(a){this.name="SchemaNotInDatabaseError",this.message=a||"The schema you tried to use does not exists in the database!"},CubeNotInDatabaseError:function(a){this.name="CubeNotInDatabaseError",this.message=a||"The cube you tried to use does not exists in the database!"},DimensionNotInDatabaseError:function(a){this.name="DimensionNotInDatabaseError",this.message=a||"The dimension you tried to use does not exists in the database!"},HierarchyNotInDatabaseError:function(a){this.name="HierarchyNotInDatabaseError",this.message=a||"The hierarchy you tried to use does not exists in the database!"},LevelNotInDatabaseError:function(a){this.name="LevelNotInDatabaseError",this.message=a||"The level you tried to use does not exists in the database!"},QueryAPINotProvidedError:function(a){this.name="QueryAPINotProvidedError",this.message=a||"Query have no queryAPI provided!"},QueryAPIServerError:function(a){this.name="QueryAPIServerError",this.message=a||"Query API indicates a Server error!"},QueryAPIBadRequestError:function(a){this.name="QueryAPIBadRequestError",this.message=a||"QueryAPI indicates a Bad Request error!"},QueryAPINotSupportedError:function(a){this.name="QueryAPINotSupportedError",this.message=a||"QueryAPI indicates a call to a not supported function!"},IllegalAPIResponseError:function(a){this.name="IllegalAPIResponseError",this.message=a||"QueryAPI has returned a response with wrong format!"},IllegalDimensionTypeError:function(a){this.name="IllegalDimensionTypeError",this.message=a||"You tried to use an illegal dimension type!"}};return b.SchemaNotInDatabaseError.prototype=new Error,b.SchemaNotInDatabaseError.prototype.constructor=b.SchemaNotInDatabaseError,b.CubeNotInDatabaseError.prototype=new Error,b.CubeNotInDatabaseError.prototype.constructor=b.CubeNotInDatabaseError,b.DimensionNotInDatabaseError.prototype=new Error,b.DimensionNotInDatabaseError.prototype.constructor=b.DimensionNotInDatabaseError,b.HierarchyNotInDatabaseError.prototype=new Error,b.HierarchyNotInDatabaseError.prototype.constructor=b.HierarchyNotInDatabaseError,b.LevelNotInDatabaseError.prototype=new Error,b.LevelNotInDatabaseError.prototype.constructor=b.LevelNotInDatabaseError,b.QueryAPIServerError.prototype=new Error,b.QueryAPIServerError.prototype.constructor=b.QueryAPIServerError,b.QueryAPINotProvidedError.prototype=new Error,b.QueryAPINotProvidedError.prototype.constructor=b.QueryAPINotProvidedError,b.QueryAPIBadRequestError.prototype=new Error,b.QueryAPIBadRequestError.prototype.constructor=b.QueryAPIBadRequestError,b.QueryAPINotSupportedError.prototype=new Error,b.QueryAPINotSupportedError.prototype.constructor=b.QueryAPINotSupportedError,b.IllegalAPIResponseError.prototype=new Error,b.IllegalAPIResponseError.prototype.constructor=b.IllegalAPIResponseError,b.IllegalDimensionTypeError.prototype=new Error,b.IllegalDimensionTypeError.prototype.constructor=b.IllegalDimensionTypeError,b}(),b.data=function(){function a(){var a=1,c=b.state.dimensions();for(var d in c)if(!c[d].aggregated()){var e=c[d].getLastSlice();a*=Object.keys(e).length}return a}function c(c){return(c?c:a())<b.csts.crossfilterClientVsServerThreshold}function d(a){var d=b.state.dimensions();for(var e in d){null!==d[e]._crossfilterDimension&&d[e]._crossfilterDimension.dispose(),d[e]._crossfilterDimension=null;for(var f in d[e]._crossfilterGroups)d[e]._crossfilterGroups[f].dispose();d[e]._crossfilterGroups=[]}return g=c()?crossfilter(a):crossfilterServer(a)}function e(){b.query.clear(),b.query.drill(b.state.cube().id());var a=b.state.dimensions();j=[];var c=[];for(var e in a){var f=a[e];if(!f.aggregated()){var g=f.getLastSlice(),h=f.hierarchy();j.push(f),c.push(h),b.query.slice(h,Object.keys(g))}}b.query.dice(c),i=b.display.getExtraMeasuresUsed(),i.push(b.state.measure());for(var k in i)b.query.push(i[k].id());var l=b.query.execute();return d(l)}function f(){var a,c={api:b.query,schema:b.state.schema(),cube:b.state.cube().id(),measures:[],dimensions:{}},e=b.state.dimensions();j=e.slice();for(a in e){var f=e[a];c.dimensions[f.id()]={hierarchy:f.hierarchy(),level:f.currentLevel(),members:Object.keys(f.getLastSlice())}}i=b.display.getExtraMeasuresUsed(),i.push(b.state.measure());for(a in i)c.measures.push(i[a].id());return d(c)}var g,h={},i=[],j=[];return h.load=function(){try{return c()?e():f()}catch(a){new PNotify({title:"Error while loading data",type:"error"})}},h.loadIfNeeded=function(){var a,d=i.map(function(a){return a.id()}),e=b.display.getExtraMeasuresUsed();for(a in e)if(d.indexOf(e[a].id())<0)return h.load(),!0;var f=j.map(function(a){return a.id()}),g=b.state.dimensions().filter(function(a){return!a.aggregated()});for(a in g)if(f.indexOf(g[a].id())<0)return h.load(),!0;var k=j.reduce(function(a,b){return a*Object.keys(b.getLastSlice()).length},1),l=c(k),m=c();return!l&&m?(h.load(),!0):!1},h.getCrossfilterDimension=function(a,b){return null===a._crossfilterDimension&&(a._crossfilterDimension=g.dimension(function(b){return b[a.id()]}),void 0!==b&&b.length&&a._crossfilterDimension.filterFunction(function(a){for(var c=0;c<b.length;c++)if(b[c]==a)return!0;return!1})),a._crossfilterDimension},h.getCrossfilterGroup=function(a,c){if(Array.isArray(c)&&0!==c.length){var d=[b.state.measure().id()];for(var e in c)d.indexOf(c[e].id())<0&&d.push(c[e].id());var f=d.sort().join(",");return void 0===a._crossfilterGroups[f]&&(a._crossfilterGroups[f]=a.crossfilterDimension().group().reduce(function(a,b){for(var c in d)a[d[c]]+=b[d[c]];return a},function(a,b){for(var c in d)a[d[c]]-=b[d[c]];return a},function(){var a={};for(var b in d)a[d[b]]=0;return a})),a._crossfilterGroups[f]}return void 0===a._crossfilterGroups.default&&(a._crossfilterGroups.default=a.crossfilterDimension().group().reduceSum(function(a){return a[b.state.measure().id()]})),a._crossfilterGroups.default},h}(),b.data.cube=function(a,b,c){var d=a,e=b,f=c,g={};return g.id=function(a){return arguments.length?(d=a,g):d},g.caption=function(a){return arguments.length?(e=a,g):e},g.description=function(a){return arguments.length?(f=a,g):f},g.equals=function(a){return"function"==typeof a.id&&d===a.id()},g},b.data.measure=function(a,b,c){var d=a,e=b,f=c,g={};return g.id=function(a){return arguments.length?(d=a,g):d},g.caption=function(a){return arguments.length?(e=a,g):e},g.description=function(a){return arguments.length?(f=a,g):f},g.equals=function(a){return"function"==typeof a.id&&d===a.id()},g},b.data.property=function(a,b,c){var d=a,e=b,f=c,g={};return g.id=function(a){return arguments.length?(d=a,g):d},g.caption=function(a){return arguments.length?(e=a,g):e},g.type=function(a){return arguments.length?(f=a,g):f},g.equals=function(a){return"function"==typeof a.id&&d===a.id()},g},b.data.dimension=function(a,c,d,e,f,g,h){var i={},j=a,k=c,l=d,m=f,n=e,o=g,p=h,q=[],r="quantile",s=b.csts.palettes[b.data.dimension.nextI++%b.csts.palettes.length],t=4;i._crossfilterDimension=null,i._crossfilterGroups={};var u=!1;i.id=function(){return j},i.caption=function(){return k},i.description=function(){return l},i.hierarchy=function(){return m},i.levels=function(){return o},i.type=function(){return n},i.properties=function(){return p},i.currentLevel=function(){return u?0:q.length-1},i.maxLevel=function(){return o.length-1},i.getGeoProperty=function(){for(var a in p)if("Geometry"==p[a].type())return p[a];return null},i.aggregated=function(a){if(!arguments.length)return u;if(u=a)i.crossfilterDimension().filterAll();else{var b=i.filters();b.length>0?i.crossfilterDimension().filterFunction(function(a){for(var c=0;c<b.length;c++)if(b[c]==a)return!0;return!1}):i.crossfilterDimension().filterAll()}return i},i.membersStack=function(){return q.map(function(a){return a.members})},i.filtersStack=function(){return q.map(function(a){return a.filters})},i.equals=function(a){return"function"==typeof a.id&&j===a.id()},i.addSlice=function(a){return q.push({members:a,filters:[]}),i},i.removeLastSlice=function(){return q=q.slice(0,-1),i},i.getLastSlice=function(){return i.getSlice(q.length-1)},i.getLastFilters=function(){return i.getFilters(q.length-1)},i.getSlice=function(a){return q[a].members},i.getFilters=function(a){return q[a].filters},i.isDrillPossible=function(){return i.currentLevel()<i.maxLevel()&&!v},i.isRollPossible=function(){return i.currentLevel()>0},i.nbRollPossible=function(){return i.currentLevel()};var v=!1;return i.isPartialDrillDown=function(a){return arguments.length?(v=a,i):v},i.filters=function(a){return arguments.length?(q[q.length-1].filters=a,i):i.getLastFilters()},i.filter=function(a,b){return b?i.addFilter(a):i.removeFilter(a)},i.addFilter=function(a){var b=i.getLastFilters();return b.indexOf(a)<0&&b.push(a),i},i.removeFilter=function(a){var b=i.getLastFilters();return b.indexOf(a)>=0&&b.splice(b.indexOf(a)),i},i.colors=function(){return colorbrewer[s][t]},i.scaleType=function(a){return arguments.length?(r=a,i):r},i.colorPalette=function(a){return arguments.length?(s=a,i):s},i.nbBins=function(a){return arguments.length?(t=a,i):t},i.scale=function(){switch("natural"==r&&i.crossfilterGroup().all().length<=t&&(r="quantize"),r){case"natural":return d3.scale.threshold().domain(ss.jenks(i.crossfilterGroup().all().map(function(a){return a.value}),t).splice(1,t-1)).range(i.colors());case"quantize":var a=i.crossfilterGroup().order(function(a){return-a}).top(1)[0].value,b=i.crossfilterGroup().order(function(a){return a}).top(1)[0].value;return d3.scale.quantize().domain([a,b]).range(i.colors());case"quantile":return d3.scale.quantile().domain(i.crossfilterGroup().all().map(function(a){return a.value})).range(i.colors())}},i.crossfilterDimension=function(){return b.data.getCrossfilterDimension(i,i.getLastFilters())},i.crossfilterGroup=function(a){return b.data.getCrossfilterGroup(i,a)},i.getTotal=function(){function a(a){return 0===i.filters().length||i.filters().indexOf(a)>=0}return i.crossfilterGroup().all().filter(function(b){return a(b.key)}).map(function(a){return a.value}).reduce(function(a,b){return a+b},0)},i},b.data.dimension.nextI=0,b.state=function(){function a(a,c){e.cube().equals(a)?(e.measure(c),b.data.load(),b.display.redraw()):(e.cube(a),e.measure(c),k=[],e.initDimensions(),b.data.load(),b.display.render())}function c(){var a={schema:b.state.schema(),cube:b.state.cube().id(),measure:b.state.measure().id(),columnWidths:b.display.columnWidths()};return a.dimensions=b.state.dimensions().map(function(a){return{id:a.id(),hierarchy:a.hierarchy(),filters:a.filters(),properties:a.properties().map(function(a){return a.id()}),membersStack:a.membersStack().map(function(a){return Object.keys(a)})}}),a.charts=b.display.chartsInLayout().map(function(a,b){return b>0?a.map(function(a){return{type:a.type(),options:a.options(),dimensions:a.dimensions().map(function(a){return a.id()}),extraMeasures:a.extraMeasures().map(function(a){return a.id()})}}):[]}),a}function d(a){try{e.schema(a.schema);var c=b.query.getCubes(a.schema);e.cube(b.data.cube(a.cube,c[a.cube]));var d={},f=b.query.getMesures(a.schema,a.cube);for(var g in f)d[g]=b.data.measure(g,f[g].caption);e.measure(d[a.measure]),b.display.columnWidths(a.columnWidths);var h={},i=b.query.getDimensions(a.schema,a.cube);a.dimensions.forEach(function(c){var d=b.query.getLevels(a.schema,a.cube,c.id,c.hierarchy),e=b.query.getProperties(a.schema,a.cube,c.id,c.hierarchy,0),f=c.properties.map(function(a){return b.data.property(a,e[a].caption,e[a].type)}),g=b.data.dimension(c.id,i[c.id].caption,i[c.id].description,i[c.id].type,c.hierarchy,d,f);g.filters(c.filters),c.membersStack.forEach(function(d,e){g.addSlice(b.query.getMembersInfos(a.schema,a.cube,c.id,c.hierarchy,e,d,c.properties.length>0))}),g.filters(c.filters),k.push(g),h[g.id()]=g}),b.display.createCharts(a.charts,h,d)}catch(j){new PNotify({title:"Data for this analysis is unavailable",type:"error"})}}var e=function(a){return arguments.length?void d(a):c()},f=null,g=null,h=null,i=null,j=null,k=[];return e.schema=function(a){return arguments.length?void(f=a):f},e.cube=function(a){return arguments.length?(i=a,void(g=a.id())):i},e.measure=function(a){return arguments.length?(j=a,void(h=a.id())):j},e.dimensions=function(){return k},e.initMeasure=function(){var c=b.query.getSchemas();(null===f||void 0===c[f])&&(f=Object.keys(c)[0]);var d=b.query.getCubesAndMeasures(f);if(null===g||void 0===d[g]){var i=Object.keys(d)[0];e.cube(b.data.cube(i,d[i].caption,d[i].description))}if(null===h||void 0===d[g].measures[h]){var j=Object.keys(d[g].measures)[0];e.measure(b.data.measure(j,d[g].measures[j].caption,d[g].measures[j].description))}b.display.showFactSelector(d,e.cube(),e.measure(),a)},e.initDimensions=function(){if(!k.length){var a,c,d=b.query.getGeoDimension(f,g),e=(b.query.getTimeDimension(f,g),b.query.getDimensions(f,g));for(var h in e){var i=Object.keys(b.query.getHierarchies(f,g,h))[0],j=[];if(h==d){var l=b.query.getProperties(f,g,h,i,0),m=b.query.getGeoProperty(f,g,h,i);j.push(b.data.property(m,l[m].caption,l[m].type))}var n=b.query.getLevels(f,g,h,i),o=b.query.getMembers(f,g,h,i,0,j.length>0),p=b.data.dimension(h,e[h].caption,e[h].description,e[h].type,i,n,j);p.addSlice(o),k.push(p),"Geometry"==p.type()?a=p:"Time"==p.type()&&(c=p)}b.display.assignDimensions(k,a,c)}b.display.createWordClouds(k)},e.drillDown=function(a,c,d){if(a.isDrillPossible()){var e;switch(d){case"selected":var h=a.filters().length?a.filters():Object.keys(a.getLastSlice());e={},h.forEach(function(c){var d=b.query.getMembers(f,g,a.id(),a.hierarchy(),a.currentLevel(),a.properties().length>0,c);for(var h in d)e[h]=d[h]});break;case"partial":a.isPartialDrillDown(!0),e={};var i=a.getLastSlice();for(var j in i)j!=c&&(e[j]=i[j]);i=b.query.getMembers(f,g,a.id(),a.hierarchy(),a.currentLevel(),a.properties().length>0,c);for(j in i)e[j]=i[j];break;default:e=b.query.getMembers(f,g,a.id(),a.hierarchy(),a.currentLevel(),a.properties().length>0,c)}a.addSlice(e),b.data.load()}},e.rollUp=function(a,c){if(c=c||1,c=Math.min(c,a.nbRollPossible()),c>0){a.isPartialDrillDown(!1);for(var d=0;c>d;d++)a.removeLastSlice();b.data.load()}},e}(),b.display=function(){function c(a){return $($(b.csts.css.columns)[a])}function d(a){for(var b=0;b<y.length;b++)for(var c=0;c<y[b].length;c++)if(a.selector()==y[b][c].selector())return{i:b,j:c};return null}function e(a,d,e){d=Math.max(0,Math.min(y.length-1,d)),e=Math.max(0,Math.min(y[d].length,e)),e==y[d].length?y[d][e]=a:y[d].splice(e,0,a);var f=c(d).children("div"),g='<div id="'+a.selectorName()+'" class="'+b.csts.css.chartsClass+'"></div>';0===f.length&&c(d).html(g),f.length<=e?$(f[f.length-1]).after(g):$(f[e]).before(g)}function f(){var a=b.charts.wordcloud("#chart-"+x++);e(a,1,0),w._displayParamsForm(a,!0)}function g(a){var b=d(a),c=a.selector();return $(c).remove(),a.delete(),y[b.i].splice(b.j,1),b}function h(a,c){var d=a.options(),f=(a.selector(),g(a));a=b.charts[c]("#chart-"+x++);for(var h in d)a.setOption(h,d[h]);return e(a,f.i,f.j),a}function i(a){y[a].forEach(function(a){var b=a.selector();a.delete(),$(b).remove()}),y[a]=[]}function j(){0===w.charts().length&&(e(b.charts.map("#chart-"+x++),1,0),e(b.charts.timeline("#chart-"+x++),1,1),e(b.charts.table("#chart-"+x++),1,2),e(b.charts.pie("#chart-"+x++),2,0),e(b.charts.bar("#chart-"+x++),2,1))}function k(){var a={};w.charts().forEach(function(b){a[b.selectorName()]=b}),y=[[],[],[]];for(var b=0;3>b;b++){c(b).children("div").each(function(c){y[b][c]=a[$(this).attr("id")]})}}function l(a,c){var d=!1,e=!1,f=!1,g=!1,i=b.charts[c.type].params.nbDimensionsMax,j=b.charts[c.type].params.nbExtraMeasuresMax;if(c.dimensions=c.dimensions.slice(0,i).filter(function(a){return"undefined"!=typeof a.id}),c.measures=c.measures.slice(0,j).filter(function(a){return"undefined"!=typeof a.id}),c.dimensions.filter(function(a){return a.aggregated()}).length)return void new PNotify("You cannot use aggregated dimensions");if(!b.charts[c.type].arePossibleDimensions(c.dimensions))return void new PNotify("Invalid dimensions selected");if(!b.charts[c.type].arePossibleExtraMeasures(c.measures))return void new PNotify("Invalid axes selected");if(a.type()!=c.type&&(a=h(a,c.type),e=!0),t(c.dimensions,a.dimensions())||(a.dimensions(c.dimensions),f=!0,d=!0),t(c.measures,a.extraMeasures())||(a.extraMeasures(c.measures),f=!0,g=!0),null!==b.charts[c.type].options.sort&&a.options().sort!=c.sort&&(a.setOption("sort",c.sort),f=!0),null!==b.charts[c.type].options.labels&&a.options().labels!=c.labels&&(a.setOption("labels",c.labels),e=!0),b.charts[c.type].params.displayPlay&&a.options().playerTimeout!=c.playerTimeout&&(c.playerTimeout<50&&(c.playerTimeout=50),a.setOption("playerTimeout",c.playerTimeout)),g){var k=b.data.loadIfNeeded();a.render(),k&&b.display.redraw()}else e?a.render():f&&a.redraw();d&&(a.element().filterAll(),n(a),a.redraw())}function m(a,b){a.colorPalette(b.palette),a.nbBins(b.number),a.scaleType(b.scale),w.redraw()}function n(a){a.dimensions()[0].filters().forEach(function(b){a.element().hasFilter(b)||a.element().filter(b)})}function o(){b.state.dimensions().forEach(function(a){var b=a.filters(),c=w.getChartsUsingDimension(a);if(b.length&&c.length){var d=c[0];b.forEach(function(a){d.element().hasFilter(a)||d.element().filter(a)})}})}function p(){$(b.csts.css.reset).click(function(){w.filterAll(),w.redraw()});var a=$("body").css("padding-top"),c=$(b.csts.css.header).height(),d=$(b.csts.css.columns).cssUnit("top");$(b.csts.css.resize).click(function(){$(b.csts.css.header).toggle(),$(b.csts.css.header).is(":hidden")?($(b.csts.css.columns).css("top",d[0]-c+d[1]),$("body").css("padding-top","0")):($(b.csts.css.columns).css("top",d.join("")),$("body").css("padding-top",a)),r()}),$(b.csts.css.addchart).click(function(){f()})}function q(){$(b.csts.css.columnsContainer).resizableColumns(),u=$(b.csts.css.columnsContainer).data("resizableColumns"),"undefined"!=typeof v&&u.restoreColumnWidths(v);var a=window.setTimeout(function(){},0);$(window).on("resize",function(){window.clearTimeout(a),a=window.setTimeout(function(){$(window).trigger("resizeend")},350)}),$(window).on("resizeend",r),$(window).on("column:resize:stop",r),$(b.csts.css.columnsSortable).sortable({distance:20,connectWith:b.csts.css.columnsSortable,handle:".chart-header",opacity:.6,cursor:"move",scroll:!1,update:function(){k(),w.resize()}})}function r(){w.charts().forEach(function(a){a.resize()})}function s(){var a=w.charts();for(var b in a)a[b].build();o()}function t(a,b){if(a.length!=b.length)return!1;for(var c in a)if(!a[c].equals(b[c]))return!1;return!0}var u,v,w={},x=0,y=[[],[],[]];w.columnWidths=function(a){return arguments.length?(v=a,w):u.saveColumnWidths()},w.getTip=function(a,c){return b.csts.tips[a]&&b.csts.tips[a][c]?b.csts.tips[a][c]:""},w.charts=function(){return Array.prototype.concat.apply([],y)},w.chartsInLayout=function(){return y},w.getChartsUsingDimension=function(a){var b=w.charts(),c=[];for(var d in b)b[d].useDimension(a)&&c.push(b[d]);return c},w.getExtraMeasuresUsed=function(){var a={};w.charts().forEach(function(b){b.extraMeasures().forEach(function(b){a[b.id()]=b})});var b=[];for(var c in a)b.push(a[c]);return b},w.createCharts=function(a,c,d){a.forEach(function(a,f){a.forEach(function(a,g){var h=b.charts[a.type]("#chart-"+x++).dimensions(a.dimensions.map(function(a){return c[a]
})).extraMeasures(a.extraMeasures.map(function(a){return d[a]}));for(var i in a.options)h.setOption(i,a.options[i]);e(h,f,g)})})},w.createWordClouds=function(a){i(0);for(var c in a){var d=a[c];e(b.charts.wordcloudWithLegend("#chart-"+x++,[d]),0,1/0)}},w.assignDimensions=function(a,b,c){var d,e=w.charts();for(d in e){var f=e[d];f.dimensions("timeline"==f.type()?[c]:[b])}},w._displayParamsForm=function(a,c){function d(a,c){var d=b.charts[a].params.nbDimensionsMax,e=b.charts[a].params.nbExtraMeasuresMax,f=null!==b.charts[a].options.sort,g=b.charts[a].params.displayPlay,h=null!==b.charts[a].options.labels;x.slice(0,d).slideDown(c),y.slice(0,e).slideDown(c),x.slice(d).slideUp(c),y.slice(e).slideUp(c),f?u.slideDown(c):u.slideUp(c),g?v.slideDown(c):v.slideUp(c),h?w.slideDown(c):w.slideUp(c),s.children("option").removeAttr("disabled");for(B in k)b.charts[a].isPossibleDimension(k[B])||s.children('option[value="'+k[B].id()+'"]').attr("disabled","disabled");t.children("option").removeAttr("disabled");for(C in m)b.charts[a].isPossibleExtraMeasure(m[C])||t.children('option[value="'+m[C].id()+'"]').attr("disabled","disabled")}var e=a.options(),f=b.state.schema(),h=b.state.cube().id(),i=b.state.dimensions(),j=b.query.getMesures(f,h),k=(b.query.getGeoDimension(f,h),{});i.forEach(function(a){k[a.id()]=a});var m={};for(var n in j)m[n]=b.data.measure(n,j[n].caption);var o=$("#chartparam-sort"),p=$("#chartparam-type"),q=$("#chartparam-playerTimeout"),r=$("#chartparam-labelChoice"),s=$(".chartparam-dimension"),t=$(".chartparam-measure"),u=o.parent().parent(),v=q.parent().parent(),w=r.parent().parent(),x=s.parent().parent(),y=t.parent().parent();if(u.hide(),v.hide(),w.hide(),x.hide(),y.hide(),!p.children("option").length)for(var z in b.charts)if("chart"!=z&&"undefined"!=typeof b.charts[z].params&&b.charts[z].params.displayParams===!0){var A=b.csts.txts.charts[z]?b.csts.txts.charts[z]:z;p.append('<option value="'+z+'">'+A+"</option>")}s.empty().append('<option value=""></option>'),t.empty().append('<option value=""></option>');var B,C;i.forEach(function(a){s.append('<option value="'+a.id()+'">'+a.caption()+"</option>")});for(C in j)t.append('<option value="'+C+'">'+j[C].caption+"</option>");p.val(a.type()),o.val(e.sort),q.val(e.playerTimeout),r.prop("checked",e.labels===!1?"":"checked"),s.each(function(b,c){var d=a.dimensions()[b];d&&$(c).val(d.id())}),t.each(function(b,c){var d=a.extraMeasures()[b];d&&$(c).val(d.id())}),d(p.val(),0),p.change(function(){d($(this).val(),400)}),$("#chartparams-set").unbind("click").click(function(){$("#chartparams").modal("hide");var b={dimensions:[],measures:[],sort:o.val(),type:p.val(),labels:r.prop("checked"),playerTimeout:q.val()};s.each(function(a,c){var d=k[$(c).val()];d&&(b.dimensions[a]=d)}),t.each(function(a,c){var d=m[$(c).val()];d&&(b.measures[a]=d)}),l(a,b)}),$("#chartparams-cancel, #chartparams-delete").unbind("click").click(function(){$("#chartparams").modal("hide")}),c?($("#chartparams-cancel").click(function(){g(a)}),$("#chartparams-delete").hide()):$("#chartparams-delete").show().click(function(){g(a)}),$("#chartparams").modal("show")};var z=!1;return w.freezeColorScales=function(){z=!0},w.unfreezeColorScales=function(){z=!1},w.aggregateDimension=function(a,c){a.aggregated(c),w.getChartsUsingDimension(a).forEach(function(a){a.disabled(c)}),b.data.loadIfNeeded(),w.redraw()},w._displayDimensionParamsForm=function(a){function c(a){var b=colorbrewer[a][Object.keys(colorbrewer[a]).pop()],c=b.map(function(a){return'<span style="background: '+a+'"></span>'}).reduce(function(a,b){return a+b});return'<a class="color-palette" title="'+a+'">'+c+"</a>"}function d(a){$("#dimparam-color-button").html(c(a)+' <span class="caret"></span>'),$("#dimparam-color").val(a);var b=Object.keys(colorbrewer[a]).shift(),d=Object.keys(colorbrewer[a]).pop();$("#dimparam-colors-nb").attr("min",b),$("#dimparam-colors-nb").attr("max",d);var e=Math.min(Math.max(b,$("#dimparam-colors-nb").val()),d);$("#dimparam-colors-nb").val(e)}0===$("#dimparam-color-dropdown li").length&&(b.csts.palettes.forEach(function(a){$("#dimparam-color-dropdown").append("<li>"+c(a)+"</li>")}),$("#dimparam-color-dropdown li a").click(function(){d($(this).attr("title"))})),d(a.colorPalette()),$("#dimparam-colors-nb").val(a.nbBins()),$("#dimparam-scale").val(a.scaleType()),$("#dimparams-set").unbind("click").click(function(){$("#dimparams").modal("hide");var b=$("#dimparam-color").val(),c=Object.keys(colorbrewer[b]).shift(),d=Object.keys(colorbrewer[b]).pop(),e=Math.min(Math.max(c,$("#dimparam-colors-nb").val()),d),f={palette:b,number:e,scale:$("#dimparam-scale").val()};m(a,f)}),$("#dimparams").modal("show")},w.filterAll=function(){b.state.dimensions().forEach(function(a){a.filters([])}),a.filterAll()},w.filterAllChartsUsingDimension=function(a){a.filters([]);var b=w.getChartsUsingDimension(a);for(var c in b)b[c].element().filterAll()},w._updateFilter=function(a,b,c){a.filter(b,c);var d=w.getChartsUsingDimension(a);for(var e in d)d[e].element().hasFilter(b)!=c&&d[e].element().filter(b);w.charts().forEach(function(a){a.updateTitle()}),z||w.charts().forEach(function(a){a.updateColors()})},w.init=function(){j(),p(),q()},w.showFactSelector=function(a,c,d,e){b.display.factSelector.init(b.csts.css.factSelector,b.csts.txts.factSelector.cubes,b.csts.txts.factSelector.measures),b.display.factSelector.setMetadata(a),b.display.factSelector.setCallback(e),b.display.factSelector.setSelectedCube(c.id()),b.display.factSelector.setSelectedMeasure(d.id())},w.render=function(){s(),a.renderAll()},w.redraw=function(){s(),a.redrawAll()},w.drillDown=function(a,c,d,e){if(a.isDrillPossible()){var f,g;e.ctrl?(f=a.filters().length?a.filters():Object.keys(a.getLastSlice()),g="selected"):e.shift?(f=Object.keys(a.getLastSlice()),g="partial"):(f=[c],g="simple"),w.getChartsUsingDimension(a).forEach(function(a){void 0!==a.element()._onZoomIn&&a.element().chartID()!==d&&a.element()._onZoomIn(f)}),b.state.drillDown(a,c,g),w.filterAllChartsUsingDimension(a),w.redraw()}},w.rollUp=function(a,c,d){if(d=d||1,d=Math.min(d,a.nbRollPossible()),d>0){for(var e=0;d>e;e++)w.getChartsUsingDimension(a).forEach(function(a){void 0!==a.element()._onZoomOut&&a.element().chartID()!==c&&a.element()._onZoomOut()});w.filterAllChartsUsingDimension(a),b.state.rollUp(a,d),w.redraw()}},w}(),b.display.factSelector=function(){var a={container:null,cube:null,displayedCube:null,measure:null,cubes:[],measures:[],data:null,callback:null,init:function(a,b,c){this.cubes.intro=b,this.measures.intro=c,this.container=$(a),this.cubes.container=$("<div></div>"),this.measures.container=$("<div></div>"),this.container.append(this.cubes.container),this.container.append(this.measures.container)},setMetadata:function(a){this.data=a,this.showCubes(),this.resetMeasures()},showCubes:function(a){var b=this;this.cubes.data=this.data,a?this.displayDropdown(this.cubes,function(a){b.selectCube(a)}):this.displayButtons(this.cubes,function(a){b.selectCube(a)})},showMeasures:function(a){var b=this;this.measures.data=this.data[a].measures,this.displayButtons(this.measures,function(a){b.selectMeasure(a)}),this.measures.container.width()+this.cubes.container.width()>this.container.width()?"dropdown"!=this.cubes.type?(this.showCubes(!0),this.setSelectedCube(this.cube),this.measures.container.width()+this.cubes.container.width()>this.container.width()&&this.displayDropdown(this.measures,function(a){b.selectMeasure(a)})):this.displayDropdown(this.measures,function(a){b.selectMeasure(a)}):"dropdown"===this.cubes.type&&(this.showCubes(!1),this.measures.container.width()+this.cubes.container.width()>this.container.width()&&this.showCubes(!0),this.setSelectedCube(this.cube))},displayButtons:function(a,b){this.displayList(a,b,"btn btn-group","btn btn-default"),a.container.empty(),a.container.append(a.intro+" "),a.container.append(a.list),a.type="buttons"},displayDropdown:function(a,b){this.displayList(a,b,"dropdown-menu","",!0),a.container.empty(),a.container.append(a.intro+" "),a.title=$('<a class="btn btn-default dropdown-toggle" data-toggle="dropdown" href="#">'+a.intro+' <span class="caret"></span></a>'),a.container.append($('<div class="btn-group btn-default"></div>').append(a.title).append(a.list)),a.type="dropdown"},displayList:function(a,b,c,d,e){c=c?'class="'+c+'"':"",d=d?'class="'+d+'"':"",a.list=$("<ul "+c+"></ul>");var f=function(){return b($(this).attr("data-id")),!1};for(var g in a.data){var h=a.data[g].description,i=a.data[g].caption;if(e){var j;j="undefined"!=typeof h&&h!=i?$("<a"+d+' href="#" data-id="'+g+'" data-toggle="tooltip" class="chart-infos" data-placement="bottom" title="'+h+'">'+i+"</a>").tooltip({container:"body",html:!0}):$("<a"+d+' href="#" data-id="'+g+'">'+i+"</a>"),j.click(f),a.list.append($("<li></li>").append(j))}else{var k;k="undefined"!=typeof h&&h!=i?$("<li "+d+' data-id="'+g+'" data-toggle="tooltip" class="chart-infos" data-placement="bottom" title="'+h+'">'+i+"</li>").tooltip({container:"body",html:!0}):$("<li "+d+' data-id="'+g+'">'+i+"</li>"),k.click(f),a.list.append(k)}}},resetMeasures:function(){this.measures.container.empty()},setSelectedCube:function(a){this.cube=a,this.setSelectedElement(this.cubes,a),this.showMeasures(a),this.cube===this.displayedCube&&this.setSelectedMeasure(this.measure)},setSelectedMeasure:function(a){this.setSelectedElement(this.measures,a),this.displayedCube=this.cube,this.measure=a},setSelectedElement:function(a,b){a.list.children("li").each(function(a,c){$(c).attr("data-id")==b?$(c).addClass("active"):$(c).removeClass("active")}),"dropdown"==a.type&&a.title.html(a.data[b].caption+' <span class="caret"></span></a>')},selectCube:function(a){this.setSelectedCube(a)},selectMeasure:function(a){function c(){d.setSelectedMeasure(a),d.callback(b.data.cube(d.cube,d.data[d.cube].caption),b.data.measure(a,d.data[d.cube].measures[a].caption,d.data[d.cube].measures[a].description))}var d=this;this.displayedCube!=this.cube?bootbox.confirm(b.csts.txts.changeCube,function(a){a&&c()}):c()},setCallback:function(a){this.callback=a}};return a}(),b.charts={},b.charts.player=function(b){var c=b.dimensions()[0],d=b.element().hasFilter()?b.element().filters():Object.keys(c.getLastSlice());d.sort();var e=0,f=!0,g=function(){},h=b,i={},j=function(){return e>d.length-1?(g(),h.element().filterAll(),d.forEach(function(a){h.element().filter(a)}),void a.redrawAll()):void(f&&(h.element().filter(d[e]),e-1>=0&&h.element().filter(d[e-1]),a.redrawAll(),e++,setTimeout(j,h.options().playerTimeout)))};return i.running=function(){return f},i.callback=function(a){return arguments.length?(g=a,i):g},i.start=function(){return f=!0,setTimeout(j,h.options().playerTimeout),i},i.pause=function(){return f=!1,i},i},b.charts.chart=function(){function c(c,d){function e(a){return arguments.length?void w.setOption("height",g(a,w.options().heightReference)):f(w.options().height,w.options().heightReference)}function f(a,b){return a*h(b)}function g(a,b){return a/h(b)}function h(a){switch(a){case"columnWidthRatio":return $(z).parent().width();case"columnHeightRatio":return $(z).parent().height();default:return 1}}function i(){$(z).addClass("chart-"+w.type()),$(z).html('<div class="chart-header"></div><div class="chart-text">'+b.csts.txts.hiddenChart+'</div><div class="chart-container"></div>')}function j(){$(z).resizable({handles:"s"}).on("resize",function(a){a.stopPropagation()}).on("resizestop",function(a){a.stopPropagation(),w.resize()})}function k(){o(),p(),q(),u()}function l(){w.element().width(w.width()).height(e()).on("filtered",function(a,c){b.display._updateFilter(w.dimensions()[0],c,a.hasFilter(c))}),"function"==typeof w.element().callbackZoomIn&&w.element().callbackZoomIn(function(a,c,d){b.display.drillDown(w.dimensions()[0],a,c,d)}).callbackZoomOut(function(a){b.display.rollUp(w.dimensions()[0],a)}),"function"==typeof w.element().colors&&w.element().colorCalculator(function(a){return a.value?w.element().colors()(a.value):"#ccc"})}function m(){r(),s(),t()}function n(){var a=x[0],c=a.getLastSlice(),d=d3.format(".3s");switch(w.element().dimension(a.crossfilterDimension()).group(a.crossfilterGroup(y)).label(function(a){var b=a.key?a.key:a.data.key;return c[b]?c[b].caption:""}).title(function(e){var f=e.key?e.key:e.data.key,g=b.state.measure().caption()+": "+(e.value?d(e.value):0),h=a.caption()+": "+(c[f]?c[f].caption:"");return h+"\n"+g}),w.updateColors(),w.options().sort){case"valueasc":w.element().ordering(function(a){return void 0!==a.value?a.value:a.data.value});break;case"valuedesc":w.element().ordering(function(a){return void 0!==a.value?-a.value:-a.data.value});break;default:w.element().ordering(function(a){return void 0!==a.key?a.key:a.data.key})}null!==w.options().labels&&w.element().renderLabel(w.options().labels)}function o(){$(z+" .chart-header").html('<div class="chart-meta"><span class="chart-infos"></span><span class="chart-levels-icons"></span><span class="chart-levels"></span><span class="btn-params"></span><span class="chart-play"></span></div><div class="chart-title"></div>')}function p(){if(w.params().displayTip){var a=b.display.getTip("chartType",w.type());if(a){var c=$('<span data-toggle="tooltip" class="chart-infos" data-placement="bottom" title="'+a+'"><i class="fa fa-nomargin fa-info-circle"></i></span>');$(z+" .chart-meta .chart-infos").replaceWith(c),c.tooltip({container:"body",html:!0})}}}function q(){if(w.params().displayPlay){var a=$('<span class="btn btn-xs btn-default"><i class="fa fa-nomargin fa-play"></i></span>');$(z+" .chart-meta .chart-play").replaceWith(a),a.click(function(){a.children().toggleClass("fa-play"),a.children().toggleClass("fa-pause"),void 0===v?(v=b.charts.player(w),v.callback(function(){a.children().toggleClass("fa-play"),a.children().toggleClass("fa-pause"),v=void 0}),w.element().filterAll(),v.start()):v.running()?v.pause():v.start()})}}function r(){if(w.params().displayCanDrillRoll){var a=$(z+" .chart-meta .chart-levels-icons");0===a.html().length&&a.html('<span class="fa fa-nomargin fa-caret-up"></span><span class="fa fa-nomargin fa-caret-down"></span>');var b=a.find(".fa-caret-down"),c=a.find(".fa-caret-up");x[0].isRollPossible()?c.css("color","inherit"):c.css("color","#999999"),x[0].isDrillPossible()?b.css("color","inherit"):b.css("color","#999999")}}function s(){w.params().displayLevels&&$(z+" .chart-meta .chart-levels").html(x[0].currentLevel()+1+"/"+(x[0].maxLevel()+1))}function t(){if(w.params().displayTitle){var a,c,d=x[0].getTotal(),e=$('<span class="chart-total" data-toggle="tooltip" data-placement="bottom" title="'+d3.format(".6s  s")(d)+'">'+d3.format(".3s")(d)+" </span>").tooltip({container:"body"}),f=b.state.measure().description(),g=b.state.measure().caption(),h=x[0].description(),i=x[0].caption();a="undefined"!=typeof f&&f!=g?$('<span data-toggle="tooltip" class="chart-infos" data-placement="bottom" title="'+f+'">'+g+" </span>").tooltip({container:"body",html:!0}):g,c="undefined"!=typeof h&&h!=i?$('<span data-toggle="tooltip" class="chart-infos" data-placement="bottom" title="'+h+'">'+i+" </span>").tooltip({container:"body",html:!0}):i,$(z+" .chart-title").empty().append(a).append(" &bull; ").append(x[0].levels()[x[0].currentLevel()]).append(" &bull; ").append(c).append(" &bull; ").append(b.state.cube().caption()).append(" &bull; ").append("Total: ").append(e)}}function u(){if(w.params().displayParams){var a=$('<span class="btn-params btn btn-xs btn-default"><i class="fa fa-nomargin fa-cog"></i></span>');$(z+" .btn-params").replaceWith(a),a.click(function(){b.display._displayParamsForm(w)})}}var v,w={},x=d?d:[],y=[];w.type=function(){return"chart"},w.dimensions=function(a){return arguments.length?(x=a,w):x},w.useDimension=function(a){for(var b in x)if(x[b].equals(a))return!0;return!1},w.extraMeasures=function(a){return arguments.length?(y=a,w):y};var z=c;w._element=null,w.selector=function(){return z},w.selectorName=function(){return z.replace("#","")},w.width=function(){return $(z+" .chart-container").width()},w.height=function(){var a=$(z).height()-$(z+" .chart-header").outerHeight()-$(z+" .chart-container").outerHeight()+$(z+" .chart-container").height();return e(a),a},w.element=function(){return w._element},w.params=function(){return w._params},w.options=function(){return w._options},w.setOption=function(a,b){return"undefined"!=typeof w._options[a]&&null!==w._options[a]&&null!==b&&(w._options[a]=b),w},w.player=function(){return v};var A=!1;return w.disabled=function(b){return arguments.length?(b&&!A?(w.element()&&a.deregisterChart(w.element()),$(z).addClass("chart-hidden")):!b&&A&&(w.element()&&a.registerChart(w.element()),$(z).removeClass("chart-hidden")),A=b,w):A},w.build=function(){return w.element()||(i(),j(),w._initContainerSpecific(),k(),A||(w._createDcElement(),l(),w._initChartSpecific())),m(),w._updateHeaderSpecific(),A||(n(),w._updateChartSpecific()),w},w.render=function(){return w.build(),A||w.element().render(),w},w.redraw=function(){return w.element()?(w.build(),A||w.element().redraw(),w):w.render()},w.resize=function(){return w.element().width(w.width()).height(w.height()),w._resizeSpecific(),$(z).css("height","auto"),w.render()},w.updateColors=function(){return"function"!=typeof w.element().colors||A||w.element().colors(x[0].scale()),w},w.delete=function(){try{a.deregisterChart(w.element())}catch(b){}$(z).empty()},w._resizeSpecific=function(){},w._createDcElement=function(){},w._initContainerSpecific=function(){},w._initChartSpecific=function(){},w._updateHeaderSpecific=function(){},w._updateChartSpecific=function(){},w.updateTitle=function(){if(!A){var a=x[0].getTotal();$(z+" .chart-total").attr("title",d3.format(".6s")(a)).html(d3.format(".3s")(a))}},w._niceDomain=function(a,b){function c(a){return"undefined"==typeof b||"undefined"==typeof a[b]?a:a[b]}var d=a.order(function(a){return-c(a)}).top(1)[0],e=a.order(function(a){return c(a)}).top(1)[0];if(void 0!==c(d.value)&&void 0!==c(e.value)){d=c(d.value),e=c(e.value);var f=Math.floor(Math.log(e)/Math.LN10+1);return d=Math.floor(d/Math.pow(10,f-2))*Math.pow(10,f-2),e=Math.ceil(e/Math.pow(10,f-2))*Math.pow(10,f-2),[d,e]}return[0,0]},w}function d(a){var b=function(c,d){var e=a(c,d);return e._params=a.params,e._options=JSON.parse(JSON.stringify(a.options)),e.isPossibleDimension=b.isPossibleDimension,e.isPossibleExtraMeasure=b.isPossibleExtraMeasure,e.arePossibleDimensions=b.arePossibleDimensions,e.arePossibleExtraMeasures=b.arePossibleExtraMeasures,e.arePossibleDimensionsSpecific=b.arePossibleDimensionsSpecific,e.arePossibleExtraMeasuresSpecific=b.arePossibleExtraMeasuresSpecific,e};return b.arePossibleDimensions=function(a){for(var c in a)if(!b.isPossibleDimension(a[c]))return!1;return b.arePossibleDimensionsSpecific(a)&&a.length>=b.params.nbDimensionsMin&&a.length<=b.params.nbDimensionsMax},b.arePossibleExtraMeasures=function(a){for(var c in a)if(!b.isPossibleExtraMeasure(a[c]))return!1;return b.arePossibleDimensionsSpecific(a)&&a.length>=b.params.nbExtraMeasuresMin&&a.length<=b.params.nbExtraMeasuresMax},b.params=a.params,b.options=a.options,b.isPossibleDimension=a.isPossibleDimension||c.isPossibleDimension,b.isPossibleExtraMeasure=a.isPossibleExtraMeasure||c.isPossibleExtraMeasure,b.arePossibleDimensionsSpecific=a.arePossibleDimensionsSpecific||c.arePossibleDimensionsSpecific,b.arePossibleExtraMeasuresSpecific=a.arePossibleExtraMeasuresSpecific||c.arePossibleExtraMeasuresSpecific,b}c.params={nbDimensionsMin:1,nbDimensionsMax:1,nbExtraMeasuresMin:0,nbExtraMeasuresMax:0,displayTitle:!0,displayParams:!0,displayLevels:!0,displayCanDrillRoll:!0,displayTip:!0,displayPlay:!1},c.options={sort:null,labels:null,playerTimeout:300,height:300,heightReference:"px"},c.isPossibleDimension=function(){return!0},c.isPossibleExtraMeasure=function(){return!0},c.arePossibleDimensionsSpecific=function(){return!0},c.arePossibleExtraMeasuresSpecific=function(){return!0};var e=d(c);return e.extend=function(a){var b;if("undefined"==typeof a.params)a.params=JSON.parse(JSON.stringify(c.params));else for(b in c.params)"undefined"==typeof a.params[b]&&(a.params[b]=c.params[b]);if("undefined"==typeof a.options)a.options=JSON.parse(JSON.stringify(c.options));else for(b in c.options)"undefined"==typeof a.options[b]&&(a.options[b]=c.options[b]);var e=d(a);return e},e}(),b.charts.map=function(){var c=function(c,d){function e(a,b){var c=[];for(var d in a){var e=$.extend({},a[d][b]);e.id=d,e.properties={name:a[d].caption},c.push(e)}return c}var f=b.charts.chart(c,d);return f.type=function(){return"map"},f._initContainerSpecific=function(){},f._createDcElement=function(){f._element=a.geoChoroplethChart(f.selector()+" .chart-container")},f._initChartSpecific=function(){f.element().colorCalculator(function(a){return a?f.element().colors()(a):"#ccc"}).projection(d3.geo.mercator());var a=d3.select(f.selector()).append("div").attr("id",b.csts.css.zoom);a.append("a").attr("class","btn btn-primary fa fa-search-plus").attr("href","#").on("click",function(){return f.element().addScale(1.35,700),!1}),a.append("a").attr("class","btn btn-primary fa fa-search-minus").attr("href","#").on("click",function(){return f.element().addScale(1/1.35,700),!1})},f._updateChartSpecific=function(){var a,b=f.dimensions()[0],c=b.getLastSlice(),d=e(c,b.getGeoProperty().id()),g=f.element().geoJsons();for(a=b.currentLevel();a<g.length;a++)f.element().removeGeoJson(g[a].name);var h=function(a){return a.id};for(a=g.length;a<b.currentLevel();a++){var i=b.getSlice(a),j=e(i,b.getGeoProperty().id());f.element().overlayGeoJson(j,"geolayer-"+a,h)}f.element().overlayGeoJson(d,"geolayer-"+b.currentLevel(),h);var k=d3.format(".3s");f.element().dimension(b.crossfilterDimension()).group(b.crossfilterGroup()).setNbZoomLevels(b.maxLevel()).title(function(a){return void 0===c[a.key]?a.value?k(a.value):"":c[a.key].caption+"\nValue: "+(a.value?k(a.value):0)})},f.resizeSpecific=function(){var a=$(f.selector()).width()-30,b=$(f.selector()).height();f.element().width(a).height(b)},f};return c.options={sort:null,height:.7,heightReference:"columnHeightRatio"},c.isPossibleDimension=function(a){return"Geometry"==a.type()},b.charts.chart.extend(c)}(),b.charts.pie=function(){var c=function(c,d){var e=b.charts.chart(c,d);return e.type=function(){return"pie"},e._createDcElement=function(){e._element=a.pieChart(e.selector()+" .chart-container")},e._initChartSpecific=function(){e.element().minAngleForLabel(.3).ordering(function(a){return a.value})},e._resizeSpecific=function(){e.element().radius(0)},e};return c.options={sort:"valueasc",labels:!0},b.charts.chart.extend(c)}(),b.charts.bar=function(){var c=function(c,d){var e=b.charts.chart(c,d);return e.type=function(){return"bar"},e._createDcElement=function(){e._element=a.barChart(e.selector()+" .chart-container")},e._initChartSpecific=function(){e.element().margins({top:10,right:10,bottom:125,left:40}).renderlet(function(a){a.selectAll("g.x text").attr("dx","-50").attr("transform","translate(-20,0)").attr("transform","rotate(-50)")}).transitionDuration(500).centerBar(!1).gap(1).elasticY(!0).elasticX(!0)},e._updateChartSpecific=function(){var b=e.dimensions()[0].getLastSlice(),c=d3.format(".3s");e.element().x(d3.scale.ordinal().domain(d3.keys(b))).xUnits(a.units.ordinal).title(function(a){var d=a.key?a.key:a.data.key;return void 0===b[d]?a.value?c(a.value):"":b[d].caption+"\nValue: "+(a.value?c(a.value):0)}),e.element().xAxis().tickFormat(function(a){return b[a].caption}),e.element().yAxis().tickFormat(function(a){return c(a)})},e};return c.options={sort:"valueasc"},b.charts.chart.extend(c)}(),b.charts.timeline=function(){var a=function(a,c){var d=b.charts.bar(a,c);return d.type=function(){return"timeline"},d};return a.options={sort:null,height:.3,heightReference:"columnHeightRatio"},a.params={displayPlay:!0},a.isPossibleDimension=function(a){return"Time"==a.type()},b.charts.chart.extend(a)}(),b.charts.table=function(){var c=function(c,d){function e(a){switch(a){case"key":f.element().order(d3.ascending).sortBy(function(a){return a.key});break;case"valueasc":f.element().order(d3.descending).sortBy(function(a){return-a.value});break;default:f.element().order(d3.descending).sortBy(function(a){return a.value}),f.setOption("sort","valuedesc")}}var f=b.charts.chart(c,d);return f.type=function(){return"table"},f._initContainerSpecific=function(){$(f.selector()+" .chart-container").addClass("chart dc-chart"),$(f.selector()+" .chart-container").html("<table><thead><tr><th>Element</th><th>Value</th></tr></thead></table>")},f._createDcElement=function(){f._element=a.dataTable(f.selector()+" table")},f._initChartSpecific=function(){var a=f.dimensions()[0],b=a.getLastSlice(),c=d3.format(".3s");f.element().size(1/0).columns([function(a){var c=a.key?a.key:a.data.key;return void 0===b[c]?c:b[c].caption},function(a){return a.value?c(a.value):0}])},f._updateChartSpecific=function(){var a=f.dimensions()[0];$(f.selector()+" table th:first").html(a.caption()),$(f.selector()+" table th:last").html(b.state.measure().caption()),f.element().dimension(a.crossfilterGroup()).group(function(){return""}),e(f.options().sort)},f};return c.options={sort:"valuedesc"},b.charts.chart.extend(c)}(),b.charts.wordcloud=function(){var c=function(c,d){var e=b.charts.chart(c,d);return e.type=function(){return"wordcloud"},e._createDcElement=function(){e._element=a.wordCloudChart(e.selector()+" .chart-container")},e._initChartSpecific=function(){e.element().colorCalculator(function(a){return a?e.element().colors()(a):"#ccc"})},e};return b.charts.chart.extend(c)}(),b.charts.wordcloudWithLegend=function(){var c=function(c,d){var e=b.charts.chart(c,d);return e.type=function(){return"wordcloudWithLegend"},e._createDcElement=function(){e._element=a.wordCloudChart(e.selector()+" .chart-container")},e._initChartSpecific=function(){e.element().showLegend(e.selector()+" .wordcloud-legend").colorCalculator(function(a){return a?e.element().colors()(a):"#ccc"}),$(e.selector()+" .chart-header").css("cursor","pointer"),$(e.selector()+" .chart-header").click(function(){var a=e.dimensions()[0];b.display.aggregateDimension(a,!a.aggregated())})},e._initContainerSpecific=function(){$(e.selector()).append('<div class="wordcloud-legend"></div><div class="btn-dimparams-container"><span class="btn-dimparams btn btn-xs btn-default"><i class="fa fa-nomargin fa-cog"></i></span></div>'),$(e.selector()+" .btn-dimparams").click(function(){b.display._displayDimensionParamsForm(e.dimensions()[0])})},e._updateHeaderSpecific=function(){$(e.selector()+" .chart-title").prepend(e.dimensions()[0].aggregated()?'<i class="fa fa-chevron-right"></i>':'<i class="fa fa-chevron-down"></i>')},e};return c.params={displayParams:!1},b.charts.chart.extend(c)}(),b.charts.bubble=function(){var c=function(c,d){var e=b.charts.chart(c,d);return e.type=function(){return"bubble"},e._createDcElement=function(){e._element=a.bubbleChart(e.selector()+" .chart-container")},e._initChartSpecific=function(){var a=d3.format(".3s");e.element().colorCalculator(function(a){var c=b.state.measure().id();return a.value[c]?e.element().colors()(a.value[c]):"#ccc"}).margins({top:0,right:0,bottom:30,left:45}).elasticY(!0).elasticX(!0).elasticRadius(!0).renderHorizontalGridLines(!0).renderVerticalGridLines(!0).maxBubbleRelativeSize(.075),e.element().yAxis().tickFormat(function(b){return a(b)}),e.element().xAxis().tickFormat(function(b){return a(b)})},e._updateChartSpecific=function(){var a=e.extraMeasures(),c=[a[0],a[1],b.state.measure()],d=e.dimensions()[0],f=d.getLastSlice(),g=d.crossfilterGroup(a),h=d3.format(".3s");e.element().keyAccessor(function(a){return a.value[c[0].id()]}).valueAccessor(function(a){return a.value[c[1].id()]}).radiusValueAccessor(function(a){return a.value[c[2].id()]}).x(d3.scale.linear().domain(e._niceDomain(g,c[0].id()))).y(d3.scale.linear().domain(e._niceDomain(g,c[1].id()))).r(d3.scale.linear().domain(e._niceDomain(g,c[2].id()))).xAxisLabel(c[0].caption()).yAxisLabel(c[1].caption()).xAxisPadding(.1*e._niceDomain(g,c[0].id())[0]).yAxisPadding(.1*e._niceDomain(g,c[1].id())[0]).minRadiusWithLabel(14).title(function(a){var b=a.key?a.key:a.data.key;if(void 0===f[b])return a.value?h(a.value):"";var e=d.caption()+": "+(f[b]?f[b].caption:"")+"\n"+c[0].caption()+": "+(a.value[c[0].id()]?h(a.value[c[0].id()]):0)+"\n";return c[1].equals(c[0])||(e+=c[1].caption()+": "+(a.value[c[1].id()]?h(a.value[c[1].id()]):0)+"\n"),c[2].equals(c[0])||c[2].equals(c[1])||(e+=c[2].caption()+": "+(a.value[c[2].id()]?h(a.value[c[2].id()]):0)+"\n"),e})},e};return c.options={labels:!0,height:500},c.params={nbExtraMeasuresMin:2,nbExtraMeasuresMax:2},b.charts.chart.extend(c)}(),b}"function"==typeof define&&define.amd?define(["dc"],a):"object"==typeof module&&module.exports?module.exports=a(dc):this.analytics=a(dc)}();
//# sourceMappingURL=analytics.min.js.map